% Copyright 2005-2016 Airbus-EDF-IMACS-Phimeca
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.2
% or any later version published by the Free Software Foundation;
% with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
% Texts.  A copy of the license is included in the section entitled "GNU
% Free Documentation License".
\renewcommand{\filename}{docUC_StocProc_ARMA_Multivariate_Estimation_Likelihood.tex}
\renewcommand{\filetitle}{UC : Estimation of a multivariate ARMA process}
% \HeaderNNIILevel
% \HeaderIILevel
\HeaderIIILevel

\label{ARMAMultivariateEstimationLikelihood}


\index{Stochastic Process!ARMA}

The objective of the Use Case is to estimate a multivariate ARMA model from a stationary time series using the maximum likelihood estimator and a centered normal white noise.\\

The data can be a unique time series or several time series collected in a process sample. \\

Let $(t_i, \vect{X}_i)_{0\leq i \leq n-1}$ be a multivariate time series of dimension $d$ generated by an ARMA process represented by equation (\ref{dimn}), where $(p,q)$ are supposed to be known. We assume that the white noise $\varepsilon$ is distributed according to the normal distribution with zero mean and with covariance matrix $\mat{\Sigma}_{\varepsilon} = \sigma^2\mat{Q}$ where $|\mat{Q}| = 1$ .\\

The normality of the white noise implies the normality of the process. If we note $\vect{W} = (\vect{X}_0, \hdots, \vect{X}_{n-1})$, then $\vect{W}$ is normal with zero mean. Its  covariance matrix writes $\mathbb{E}(\vect{W}\vect{W}^t)= \sigma^2 \Sigma_{\vect{W}}$ which depends on the coefficients $(\mat{A}_k, \mat{B}_l)$ for $k = 1,\ldots,p$ and $l = 1,\ldots, q$ and on the matrix $\mat{Q}$.

The likelihood of $\vect{W}$ writes :
\begin{equation}\label{likelihoodMV}
  L(\vect{\beta}, \sigma^2 | \vect{W}) = (2 \pi \sigma^2) ^{-\frac{d n}{2}} |\Sigma_{w}|^{-\frac{1}{2}} \exp\left(- (2\sigma^2)^{-1}  \vect{W}^t \Sigma_{\vect{W}}^{-1}  \vect{W} \right)
\end{equation}
where  $\vect{\beta} = (\mat{A}_{k}, \mat{B}_{l}, \mat{Q}),\ k = 1,\ldots,p$, $l = 1,\ldots, q$ and where  $|.|$ denotes the determinant.\\

The difficulty arises from the great size ($dn \times dn$) of $\Sigma_{\vect{W}}$ which is a dense matrix in the general case. Maurucio J. A.(\emph{The exact likelihood function of a vector autoregressive moving average model}, 1996) proposes an efficient algorithm to evaluate the likelihood function. The main point is to use a change of variable that leads to a block-diagonal sparse covariance matrix.\\

The Whitle estimation requires that :
\begin{itemize}
\item the determinant of the eigen values of the companion matrix associated to the polynomial  $\mat{I} + \mat{A}_1\mat{X} + \dots + \mat{A}_p\mat{X}^p$ are outside the unit disc, which garantees the stationarity of the process;
\item the determinant of the eigen values of the companion matrix associated to the polynomial  $\mat{I} + \mat{B}_1\mat{X} + \dots + \mat{B}_q\mat{X}^q$ are outside the unit disc, which garantees the invertibility of the process.
\end{itemize}

OpenTURNS estimates $(\vect{\beta}, \sigma^2)$  thanks to the \emph{ARMALikelihoodFactory} object and its method \emph{build}, acting on a time series or on a sample of time series. It produces a result of type \emph{ARMA}. \\

Note that no evaluation of selection criteria such as \textit{AIC} and \textit{BIC} is done. \\


\requirements{
  \begin{description}
  \item[$\bullet$] order of the model and dimension of the underlying process: {\itshape p, q, d}
  \item[type:]  integer
  \end{description}

  \begin{description}
  \item[$\bullet$] a time series or collection of time series : {\itshape myTimeSeries}, {\itshape mySample}
  \item[type:]  TimeSeries, ProcessSample
  \end{description}
}
{
  \begin{description}
  \item[$\bullet$] the ARMA likelihood factory : {\itshape myFactory}
  \item[type:]  ARMALikelihoodFactory
  \end{description}

  \begin{description}
  \item[$\bullet$] the white noise : {\itshape myWhiteNoise}
  \item[type:]  WhiteNoise
  \end{description}

  \begin{description}
  \item[$\bullet$] an ARMA process {\itshape myARMA}
  \item[type:]  ARMA
  \end{description}

}

\textspace\\
Python script for this Use Case :
\begin{lstlisting}

  # Build a factory
  myFactory = ARMALikelihoodFactory(p, q, d)

  # Estimate the ARMA model coefficients from a time series
  myARMA = myFactory.build(myTimeSeries)

  # Estimate the ARMA model coefficients from a process sample
  myARMA = myFactory.build(mySample)

  # Get the white noise of the ARMA given
  myWhiteNoise = myARMA.getWhiteNoise()
\end{lstlisting}
